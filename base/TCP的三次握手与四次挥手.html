<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP的三次握手与四次挥手 | Lymon的博客</title>
    <meta name="description" content="Lymon的个人站点">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.513c5240.css" as="style"><link rel="preload" href="/assets/js/app.ae0f493e.js" as="script"><link rel="preload" href="/assets/js/2.0f23c357.js" as="script"><link rel="preload" href="/assets/js/22.3ab2ca6d.js" as="script"><link rel="prefetch" href="/assets/js/10.5e3d6902.js"><link rel="prefetch" href="/assets/js/11.bf2ec6e2.js"><link rel="prefetch" href="/assets/js/12.17f1aa80.js"><link rel="prefetch" href="/assets/js/13.dbaa2cf4.js"><link rel="prefetch" href="/assets/js/14.d360b80b.js"><link rel="prefetch" href="/assets/js/15.08061202.js"><link rel="prefetch" href="/assets/js/16.fc1158f2.js"><link rel="prefetch" href="/assets/js/17.70c6ac61.js"><link rel="prefetch" href="/assets/js/18.6cdb2499.js"><link rel="prefetch" href="/assets/js/19.45569f27.js"><link rel="prefetch" href="/assets/js/20.3a29bbd4.js"><link rel="prefetch" href="/assets/js/21.b697348b.js"><link rel="prefetch" href="/assets/js/23.ac7e4c2b.js"><link rel="prefetch" href="/assets/js/24.ce5db749.js"><link rel="prefetch" href="/assets/js/25.85c21ee4.js"><link rel="prefetch" href="/assets/js/26.eda8f948.js"><link rel="prefetch" href="/assets/js/27.7fc7aa0d.js"><link rel="prefetch" href="/assets/js/28.59c98a57.js"><link rel="prefetch" href="/assets/js/29.dc0ca9dd.js"><link rel="prefetch" href="/assets/js/3.7fd9730c.js"><link rel="prefetch" href="/assets/js/30.67b96170.js"><link rel="prefetch" href="/assets/js/31.0d22a2e4.js"><link rel="prefetch" href="/assets/js/32.7c5138a0.js"><link rel="prefetch" href="/assets/js/4.40445302.js"><link rel="prefetch" href="/assets/js/5.aeba62d3.js"><link rel="prefetch" href="/assets/js/6.04b429db.js"><link rel="prefetch" href="/assets/js/7.ddc2e6bf.js"><link rel="prefetch" href="/assets/js/8.5517920f.js"><link rel="prefetch" href="/assets/js/9.e2d58400.js">
    <link rel="stylesheet" href="/assets/css/0.styles.513c5240.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Lymon的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/base/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/cssHack/" class="nav-link">CSS技巧</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/thinking/" class="nav-link">感想</a></div><div class="nav-item"><a href="https://www.github.com/zLymon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/base/" class="nav-link router-link-active">基础</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/cssHack/" class="nav-link">CSS技巧</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/thinking/" class="nav-link">感想</a></div><div class="nav-item"><a href="https://www.github.com/zLymon" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/base/HTTP响应码与字段表.html" class="sidebar-link">HTTP响应码与字段表</a></li><li><a href="/base/TCP的三次握手与四次挥手.html" class="active sidebar-link">TCP的三次握手与四次挥手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/base/TCP的三次握手与四次挥手.html#三次握手" class="sidebar-link">三次握手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/base/TCP的三次握手与四次挥手.html#为什么要进行三次握手" class="sidebar-link">为什么要进行三次握手</a></li></ul></li><li class="sidebar-sub-header"><a href="/base/TCP的三次握手与四次挥手.html#四次挥手" class="sidebar-link">四次挥手</a></li><li class="sidebar-sub-header"><a href="/base/TCP的三次握手与四次挥手.html#为什么建立连接是三次握手，而关闭连接是四次挥手" class="sidebar-link">为什么建立连接是三次握手，而关闭连接是四次挥手</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp的三次握手与四次挥手"><a href="#tcp的三次握手与四次挥手" aria-hidden="true" class="header-anchor">#</a> TCP的三次握手与四次挥手</h1> <p>TCP在发送数据前，通信双方必须在彼此间建立一条连接，而这个<strong>连接</strong>，其实是客户端和服务端的内存里保存的一份关于对方的信息，如ip地址、端口号等。所以TCP采用三次握手建立一个连接，采用四次挥手来关闭一个连接。</p> <h2 id="三次握手"><a href="#三次握手" aria-hidden="true" class="header-anchor">#</a> 三次握手</h2> <p>TCP在握手过程中使用来TCP的标志：SYN(synchronize)和ACK(acknowledgement)标志。</p> <ol><li>发送端先发送一个带SYN标志的数据包给接收端；</li> <li>接收端接收到后，回传一个带有SYN/ACK标志的数据包，表示接收到前面的确认信息；</li> <li>发送端接收到SYN/ACK标志的数据包后，再次发送一个带ACK标志的数据包给接收端，表示连接成功，握手结束。</li></ol> <h3 id="为什么要进行三次握手"><a href="#为什么要进行三次握手" aria-hidden="true" class="header-anchor">#</a> 为什么要进行三次握手</h3> <p>三次握手的作用是<code>确认双方都能够确认自己和对方的收、发能力是正常的</code>。所以来分析一下三次握手中每次握手的作用：</p> <ol><li>第一次握手：客户端发送数据包，服务端收到了，则服务端知道了<code>客户端发送能力和服务端的接收能力是正常的</code>;</li> <li>第二次握手：服务端发送数据包，客户端收到了，则客户端知道了<code>服务端的接收、发送能力和客户端的接收、发送能力是正常的</code>；</li> <li>第三次握手：客户端发送数据包，服务端再次收到，则服务端知道了<code>服务端的发送、接收能力和客户端的接收、发送能力是正常的</code>。</li></ol> <p>通过三次握手的过程，双方都能够确认自己和对方的收、发能力是正常的，所以最少需要三次握手过程。</p> <h2 id="四次挥手"><a href="#四次挥手" aria-hidden="true" class="header-anchor">#</a> 四次挥手</h2> <p>TCP连接的拆除需要发送四个包，所以也叫做四次挥手。客户端和服务器均可主动发起挥手动作。</p> <ol><li>假设客户端想要关闭连接，客户端发送一个FIN标志位置为1的数据包，表示自己已经没有数据可以发送了，但是仍然可以接收数据。发送完后，客户端进入<code>FIN_WAIT_1</code>状态；</li> <li>服务器端确认客户端的FIN包，发送一个确认包，表明自己接收到客户端关闭连接的请求，但是还没有准备好关闭连接。发送完后，服务器端进入<code>CLOSE_WAIT</code>状态，客户端接收到确认包后，进入<code>FIN_WAIT_2</code>状态，等待服务器端关闭连接；</li> <li>服务器端准备好关闭连接时，向客户端发送结束连接请求，FIN置为1。发送完后，服务器端进入<code>LAST_ACK</code>状态，等待来自客户端的最后一个ACK；</li> <li>客户端接收到来自服务器端的关闭请求，发送一个确认包，并进入<code>TIME_WAIT</code>状态，等待可能出现的要求重传的ACK包。服务器端接收到这个确认包后，关闭连接，进入<code>CLOSED</code>状态。客户端等待了某个固定时间之后，没有接收到服务器端的ACK，认为服务器端已经正常关闭连接，于是自己也关闭连接，进入<code>CLOSED</code>状态。</li></ol> <h2 id="为什么建立连接是三次握手，而关闭连接是四次挥手"><a href="#为什么建立连接是三次握手，而关闭连接是四次挥手" aria-hidden="true" class="header-anchor">#</a> 为什么建立连接是三次握手，而关闭连接是四次挥手</h2> <p>因为服务端在<code>LISTEN</code>状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，<strong>当收到对方的FIN报文时，仅仅表示对方不再发送数据了，但是还能接收数据，己方也未必把全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后</strong>，再发送FIN报文给对方来表示同意现在关闭连接。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/base/HTTP响应码与字段表.html" class="prev">
          HTTP响应码与字段表
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ae0f493e.js" defer></script><script src="/assets/js/2.0f23c357.js" defer></script><script src="/assets/js/22.3ab2ca6d.js" defer></script>
  </body>
</html>
